"use strict";var csvImport=angular.module("ngCsvImport",[]);csvImport.directive("ngCsvImport",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{content:"=?",header:"=?",headerVisible:"=?",separator:"=?",separatorVisible:"=?",result:"=?",encoding:"=?",encodingVisible:"=?",accept:"=?",acceptSize:"=?",acceptSizeExceedCallback:"=?",callback:"=?",mdButtonClass:"@?",mdInputClass:"@?",mdButtonTitle:"@?",mdSvgIcon:"@?",uploadButtonLabel:"="},template:function(n,t){var i=angular.isDefined(t.material),r=angular.isDefined(t.multiple);return'<div class="ng-csv-import"><div ng-show="headerVisible"><div class="label">Header<\/div>'+(i?'<input type="checkbox" ng-model="header"><\/div>':'<md-switch class="ng-csv-import-header-switch" ng-model="header"><\/md-switch>')+'<div ng-show="encodingVisible"><div class="label">Encoding<\/div><span>{{encoding}}<\/span><\/div><div ng-show="separatorVisible"><div class="label">Seperator<\/div><span><input class="separator-input '+(i?"_md md-input":"")+' " type="text" ng-change="changeSeparator" ng-model="separator"><span><\/div><div><input class="btn cta gray" upload-button-label="{{uploadButtonLabel}}" type="file" '+(r?"multiple":"")+' accept="{{accept}}"/>'+(i?'<md-button ng-click="onClick($event)" class="_md md-button {{mdButtonClass}}"><md-icon md-svg-icon="{{mdSvgIcon}}"><\/md-icon> {{mdButtonTitle}}<\/md-button><md-input-container style="margin:0;"><input type="text" class="_md md-input-readable md-input {{mdInputClass}}" ng-click="onClick($event)" ng-model="filename"><\/md-input-container>':"")+"<\/div><\/div>"},link:function(n,t,i){var r,f,e,u,o;if(n.separatorVisible=!!n.separatorVisible,n.headerVisible=!!n.headerVisible,n.acceptSize=n.acceptSize||Number.POSITIVE_INFINITY,n.material=angular.isDefined(i.material),n.multiple=angular.isDefined(i.multiple),n.multiple)throw new Error("Multiple attribute is not supported yet.");r=angular.element(t[0].querySelector('input[type="file"]'));f=angular.element(t[0].querySelector("md-input-container"));n.material&&r&&(r.removeClass("ng-show"),r.addClass("ng-hide"),f&&(e=angular.element(f[0].querySelector("div.md-errors-spacer")),e&&e.remove()),n.onClick=function(){r.click()});angular.element(t[0].querySelector(".separator-input")).on("keyup",function(t){if(n.content!=null){var i={csv:n.content,header:n.header,separator:t.target.value,encoding:n.encoding};n.result=u(i);n.$apply();typeof n.callback=="function"&&n.callback!=null&&n.callback(t)}});t.on("change",function(t){var i,r;if(t.target.files.length){if(t.target.files[0].size>n.acceptSize){typeof n.acceptSizeExceedCallback=="function"&&n.acceptSizeExceedCallback(t.target.files[0]);return}n.filename=t.target.files[0].name;i=new FileReader;i.onload=function(i){n.$apply(function(){var r={csv:i.target.result.replace(/\r\n|\r/g,"\n"),header:n.header,separator:n.separator};n.content=r.csv;n.result=u(r);n.result.filename=n.filename;n.$$postDigest(function(){typeof n.callback=="function"&&n.callback!=null&&n.callback(t)})})};t.target.type==="file"&&(t.target.files!=null||t.srcElement.files!=null)?i.readAsText((t.srcElement||t.target).files[0],n.encoding):n.content!=null&&(r={csv:n.content,header:!n.header,separator:n.separator},n.result=u(r),n.$$postDigest(function(){typeof n.callback=="function"&&n.callback!=null&&n.callback(t)}))}});u=function(n){var u=n.csv.split(new RegExp('\n(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$)')),h=[],c=0,l=u[0].split(n.separator).length,s=[],f,e,t,i,r;for(n.header&&(s=u[0].split(n.separator),c=1),f=c;f<u.length;f++)if(e={},t=u[f].split(new RegExp(n.separator+'(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$)')),t.length===l){if(n.header)for(i=0;i<s.length;i++)e[s[i]]=o(t[i]);else for(r=0;r<t.length;r++)e[r]=o(t[r]);h.push(e)}return h};o=function(n){return n.replace(/^\s*|\s*$/g,"").replace(/^"|"$/g,"").replace(/""/g,'"')}}}});
//# sourceMappingURL=angular-csv-import.min.js.map
